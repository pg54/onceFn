<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>唤起App</title>
    <link rel="stylesheet" href="./css/normalize.css">
    <link rel="stylesheet" href="./css//luodiye.css">
    <script src="./js/rem.js"></script>
</head>

<body>
    <div id="checkAmount">
        <!-- <p>http://www.jq22.com/webqd74</p> -->
        <img class="imgbackground" src="./images/landpage/beijing@2x.png" srcset="./images/landpage/beijing@2x.png 2x, ./images/landpage/beijing@3x.png 3x" alt="img">

        <div class="content">
            <div class="contentLine">
                <img class="inputTitle" src="./images/landpage/phone.png"><input class="tel" type="tel" maxlength="16" placeholder="请输入手机号">
            </div>
            <div class="contentLine">
                <img class="inputTitle" src="./images/landpage/password.png"><input class="password" type="password" maxlength="6" placeholder="请设置6位登录密码">
            </div>
            <!-- <div class="sendMoney">查看额度</div> -->
            <div class="sendMoney">
                <img src="./images/landpage/anniu@2x.png" srcset="./images/landpage/anniu@2x.png 2x, ./images/landpage/anniu@3x.png 3x" alt="img">
                <span class="sendMoney_btn">查看额度</span>
            </div>
        </div>
    </div>


    <div id="getMoney">
        <div class="accountNumber">
            <div class="loanNews">
                <p class="loanNews">恭喜17690760861用户借款10,000元</p>
            </div>
            <canvas id="canvas" width="540" height="290"></canvas>
            <img class="moneybackground" src="./images/landpage//money@2x.png" srcset="./images/landpage//money@2x.png 2x, ./images/landpage//money@3x.png 3x" alt="money">
            <div class="completedTel">
                <p class="completedTel_title">137****1188</p>
                <p class="completedTel_subtitle">你的现金额度预估已完成</p>
            </div>
        </div>

        <p class="loanedPerson">已超过<span class="growNumber"></span>人成功借款</p>


        <div class="quickMoney">
            <img src="./images/landpage/getMoney@2x.png" srcset="./images/landpage/getMoney@2x.png 2x, ./images/landpage/getMoney@3x.png 3x" alt="img">
            <span class="quickMoney_btn">马上拿钱</span>
        </div>
    </div>

    <div id="haveAccount">
        <div class="haveAccount_content">
            <p class="haveAccount_c">
                <svg xmlns="http://www.w3.org/2000/svg" class="closeHaveAccount" version="1.1" width="44" height="44" viewBox="0 0 32 32">
                                <title>cross</title>
                                <path d="M31.708 25.708c-0-0-0-0-0-0l-9.708-9.708 9.708-9.708c0-0 0-0 0-0 0.105-0.105 0.18-0.227 0.229-0.357 0.133-0.356 0.057-0.771-0.229-1.057l-4.586-4.586c-0.286-0.286-0.702-0.361-1.057-0.229-0.13 0.048-0.252 0.124-0.357 0.228 0 0-0 0-0 0l-9.708 9.708-9.708-9.708c-0-0-0-0-0-0-0.105-0.104-0.227-0.18-0.357-0.228-0.356-0.133-0.771-0.057-1.057 0.229l-4.586 4.586c-0.286 0.286-0.361 0.702-0.229 1.057 0.049 0.13 0.124 0.252 0.229 0.357 0 0 0 0 0 0l9.708 9.708-9.708 9.708c-0 0-0 0-0 0-0.104 0.105-0.18 0.227-0.229 0.357-0.133 0.355-0.057 0.771 0.229 1.057l4.586 4.586c0.286 0.286 0.702 0.361 1.057 0.229 0.13-0.049 0.252-0.124 0.357-0.229 0-0 0-0 0-0l9.708-9.708 9.708 9.708c0 0 0 0 0 0 0.105 0.105 0.227 0.18 0.357 0.229 0.356 0.133 0.771 0.057 1.057-0.229l4.586-4.586c0.286-0.286 0.362-0.702 0.229-1.057-0.049-0.13-0.124-0.252-0.229-0.357z"/>
                                </svg>
            </p>
            <p class="haveAccount_t">已有账号</p>
            <p class="haveAccount_s">您的手机已注册包找钱账号，请直接打开APP免费申请借款。</p>
            <p class="haveAccount_op openApp">打开APP</p>
            <p class="haveAccount_re reInput">重新输入</p>
        </div>
    </div>

    <div class="notifyWrap">
        <div class="notify">
            <div class="notify_content">
                请输入正确的手机号
            </div>
            <div class="notify_action">
                确定
            </div>
        </div>
    </div>
    <script src="./js/lodash.custom.js"></script>
    <script src="./js/jquery-2.1.1.js"></script>
    <script>
        $(function() {
            var canvas = document.getElementById("canvas");
            var context = canvas.getContext("2d");

            var canvasArea = {
                w: 540,
                h: 270
            };
            //最外层圆弧
            drawMoney();

            function drawMoney(center) {
                var h = canvasArea.h;
                var moneyNumber = 18000;
                var number = 0;
                var timer = setInterval(function() {
                    //清除画布
                    context.clearRect(0, 0, 540, 290);
                    context.fillStyle = 'rgba(255, 255, 255, 0)';
                    context.fillRect(0, 10, 540, 270);
                    //最外面一层的圆弧
                    context.beginPath();
                    context.arc(h, 10 + h, h, 0, Math.PI, true);
                    context.strokeStyle = '#fff';
                    context.lineWidth = '4';
                    context.stroke();

                    //中间的文字
                    context.beginPath();
                    context.font = "48px serif";
                    context.fillStyle = "#fff";
                    number = number + 2000;
                    context.fillText(number + '', 200, 212);

                    context.beginPath();
                    context.font = "30px serif";
                    context.fillStyle = "#fff";
                    context.fillText('日利率低至0.02%', 160, 282);

                    //滚动的小球  和方块
                    setBallAndTrick(number, 24000, h, 0.6 * h, 150, 15, 40, 20);
                    // setBallAndTrick1(moneyNumber, number, h, 15, 10, 0.6 * h, 24, 40);
                    if (number >= moneyNumber) {
                        clearInterval(timer)
                    }
                }, 500)
            }


            function setBallAndTrick(number, tNumber, h, shortR, useD, gapD, trickW, trickH) {
                var radio = number / tNumber;
                var total = useD;
                var gap = gapD;
                var deg = radio * total + gap;

                // 滚动的圆球
                if (radio < 0.5) {
                    var d = deg * Math.PI / 180;
                    context.beginPath();
                    context.arc(h - Math.cos(d) * (h), 10 + h - Math.sin(d) * (h), 10, 0,
                        Math.PI * 2, true);
                    context.fillStyle = '#fff';
                    context.fill();
                } else if (radio === 0.5) {
                    context.beginPath();
                    context.arc(h, 10 + 0, 10, 0, Math.PI * 2, true);
                    context.fillStyle = '#fff';
                    context.fill();
                } else if (radio > 0.5) {
                    var d = Math.PI - deg * Math.PI / 180;
                    var x = Math.cos(d);
                    var y = Math.sin(d);
                    context.beginPath();
                    context.arc(h + x * (h), 10 + h - y * (h), 10, 0, Math.PI * 2, true);
                    context.fillStyle = '#fff';
                    context.fill();
                } else if (radio === 1) {
                    context.beginPath();
                    context.arc(0, 2 * h, 10, 0, Math.PI * 2, true);
                    context.fillStyle = '#fff';
                    context.fill();
                }

                //方块 实心部分
                var n = number / 2000;
                console.log(n);
                for (var i = 1; i < n + 1; i++) {
                    var r = i * 2000 / tNumber;
                    if (r < 0.5) {
                        var dq = (r * useD + gapD) * Math.PI / 180;
                        context.beginPath();
                        context.lineWidth = 2;
                        context.moveTo(h - Math.cos(dq) * (shortR + trickW) + Math.sin(dq) * trickH / 2, h -
                            Math.sin(dq) * (shortR + trickW) - Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR + trickW) - Math.sin(dq) * trickH / 2, h -
                            Math.sin(dq) * (shortR + trickW) + Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR) - Math.sin(dq) * trickH / 2, h - Math.sin(dq) *
                            (shortR) + Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR) + Math.sin(dq) * trickH / 2, h - Math.sin(dq) *
                            (shortR) - Math.cos(dq) * trickH / 2);
                        context.closePath();
                    } else if (r === 0.5) {
                        context.beginPath();
                        context.lineWidth = 1;
                        context.moveTo(h - trickH / 2, h - shortR - trickW);
                        context.lineTo(h - trickH / 2, h - shortR);
                        context.lineTo(h + trickH / 2, h - shortR);
                        context.lineTo(h + trickH / 2, h - shortR - trickW);
                        context.closePath();
                    } else if (r > 0.5) {

                        var q = Math.PI - (r * useD + gapD) * Math.PI / 180;
                        context.beginPath();
                        context.lineWidth = 1;
                        context.moveTo(h + Math.cos(q) * shortR - Math.sin(q) * trickH / 2, h - Math.sin(q) *
                            shortR - Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * shortR + Math.sin(q) * trickH / 2, h - Math.sin(q) *
                            shortR + Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * (shortR + trickW) + Math.sin(q) * trickH / 2, h - Math
                            .sin(q) * (shortR + trickW) + Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * (shortR + trickW) - Math.sin(q) * trickH / 2, h - Math
                            .sin(q) * (shortR + trickW) - Math.cos(q) * trickH / 2);
                        context.closePath();
                    }
                    context.fillStyle = "#fff";
                    context.fill();
                }
                //方块 空心部分
                var t = total
                for (var j = n + 1; j < tNumber / 2000; j++) {
                    var r1 = j * 2000 / tNumber;
                    console.log(r1);
                    if (r1 < 0.5) {
                        var dq = (r1 * useD + gapD) * Math.PI / 180;
                        context.beginPath();
                        context.moveTo(h - Math.cos(dq) * (shortR + trickW) + Math.sin(dq) * trickH / 2, h -
                            Math.sin(dq) * (shortR + trickW) - Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR + trickW) - Math.sin(dq) * trickH / 2, h -
                            Math.sin(dq) * (shortR + trickW) + Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR) - Math.sin(dq) * trickH / 2, h - Math.sin(dq) *
                            (shortR) + Math.cos(dq) * trickH / 2);
                        context.lineTo(h - Math.cos(dq) * (shortR) + Math.sin(dq) * trickH / 2, h - Math.sin(dq) *
                            (shortR) - Math.cos(dq) * trickH / 2);
                        context.closePath();
                        context.lineWidth = 1;
                    } else if (r1 === 0.5) {
                        context.beginPath();
                        context.moveTo(h - trickH / 2, h - shortR - trickW);
                        context.lineTo(h - trickH / 2, h - shortR);
                        context.lineTo(h + trickH / 2, h - shortR);
                        context.lineTo(h + trickH / 2, h - shortR - trickW);
                        context.closePath();
                        context.lineWidth = 1;
                    } else if (r1 > 0.5) {
                        var q = Math.PI - (r1 * useD + gapD) * Math.PI / 180;
                        context.beginPath();
                        context.moveTo(h + Math.cos(q) * shortR - Math.sin(q) * trickH / 2, h - Math.sin(q) *
                            shortR - Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * shortR + Math.sin(q) * trickH / 2, h - Math.sin(q) *
                            shortR + Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * (shortR + trickW) + Math.sin(q) * trickH / 2, h - Math
                            .sin(q) * (shortR + trickW) + Math.cos(q) * trickH / 2);
                        context.lineTo(h + Math.cos(q) * (shortR + trickW) - Math.sin(q) * trickH / 2, h - Math
                            .sin(q) * (shortR + trickW) - Math.cos(q) * trickH / 2);
                        context.closePath();
                        context.lineWidth = 1;
                    }
                    context.strokeStyle = "#fff";
                    context.stroke();
                }
            }


            var isUserUrl = 'http://127.0.0.1:9999/api/changeInfo';
            var registerUrl = '';
            var appDownUrl = ''
                //埋点
                // var _mtac = {};
                // (function() {
                //     var mta = document.createElement("script");
                //     mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";
                //     mta.setAttribute("name", "MTAH5");
                //     mta.setAttribute("sid", "500609886");
                //     var s = document.getElementsByTagName("script")[0];
                //     s.parentNode.insertBefore(mta, s);
                // })();

            $('.openApp').on('click', function() {
                submitFn();
            })

            $('.reInput').on('click', function() {
                $("#haveAccount").hide();
                $(".tel").val('');
                $(".password").val('');
            })

            $('.closeHaveAccount').on('click', function(e) {
                $('#haveAccount').hide();
            })

            $('.tel').on('keyup', _.debounce(dsh, 600));

            $('.notify_action').on('click', function() {
                $('.notifyWrap').hide();
            });

            $('.sendMoney_btn').on('click', function() {

                var tel = $('.tel').val();
                $('.completedTel_title').html(tel.substr(0, 4) + '****' + tel.substr(7, 10))
                $('#checkAmount').hide();
                $('#getMoney').show();
                numberGrow($('.growNumber'));


                // var telReg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
                // var tel = $('.tel').val();
                // var psd = $('.password').val()
                // var telOK = tel && telReg.test(tel);
                // var psdOK = psd && psd.length === 6;
                // if (telOK && psdOK) {
                //     $.ajax({
                //         type: "POST",
                //         dataType: "text",
                //         url: isUserUrl,
                //         data: '',
                //         data: {
                //             tel: $(".tel").val(),
                //         },
                //         success: function(res) {
                //             var res = JSON.parse(res);
                //             if (res.status === 0) {
                //                 $('.completedTel_title').html(tel.substr(0, 4) + '****' + tel.substr(7, 10))
                //                 $('#checkAmount').hide();
                //                 $('#getMoney').show();
                //                 numberGrow($('.growNumber'));
                //             } else {
                //                 alert(res);
                //             }
                //         }
                //     });


                // } else {
                //     if (!telOK) {
                //         $('.notify_content').html('请输入正确的手机号');
                //         return $('.notifyWrap').show();
                //     }
                //     if (!psdOK) {
                //         $('.notify_content').html('请输入正确的密码');
                //         return $('.notifyWrap').show();
                //     }
                // }



            })

            $('.sendMoney_btn').on('click', function() {
                // MtaH5.clickStat('100001');
            })

            $('.quickMoney_btn').on('click', function() {
                window.location.href = appDownUrl;
            })

            function dsh() {
                var tel = $(".tel").val();
                var reg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
                if (reg.test(tel)) {
                    $.ajax({
                        type: "POST",
                        dataType: "text",
                        url: isUserUrl,
                        data: '',
                        data: {
                            tel: $(".tel").val(),
                        },
                        success: function(res) {
                            var res = JSON.parse(res);
                            if (res.status === 0) {
                                $("#haveAccount").show();
                            } else {
                                alert(res);
                            }
                        }
                    });
                }

            }
            $('.closeBtn').on('click', function() {
                $("#haveAccount").hide();
            })

            function submitFn() {
                //判断浏览器
                var u = navigator.userAgent;
                if (/MicroMessenger/gi.test(u)) { // 判断是不是微信浏览器
                    alert('请在浏览器中打开');
                    return;
                }
                var d = new Date();
                var t0 = d.getTime();
                var androidUrl = 'tongchengfs://byq'; //包有钱pro版的schema
                var iosUrl = 'weixin://'; //微信的schema
                if (u.indexOf('Android') > -1 || u.indexOf('Linux') > -1) {
                    //Android链接
                    if (openApp(androidUrl)) {
                        openApp(androidUrl);
                    } else {
                        //由于打开需要1～2秒，利用这个时间差来处理－－打开app后，返回h5页面会出现页面变成app下载页面，影响用户体验
                        var delay = setInterval(function() {
                            var d = new Date();
                            var t1 = d.getTime();
                            if (t1 - t0 < 3000 && t1 - t0 > 2000) {
                                alert('检测到未安装，请下载APP');
                                window.location.href = appDownUrl;
                            }
                            if (t1 - t0 >= 3000) {
                                clearInterval(delay);
                            }
                        }, 1000);
                    }
                } else if (u.indexOf('iPhone') > -1) {
                    //IOS链接
                    if (openApp(iosUrl)) {
                        openApp(iosUrl);
                    } else {
                        var delay = setInterval(function() {
                            var d = new Date();
                            var t1 = d.getTime();
                            if (t1 - t0 < 3000 && t1 - t0 > 2000) {
                                alert('检测到未安装，请下载APP');
                                window.location.href = appDownUrl;
                            }
                            if (t1 - t0 >= 3000) {
                                clearInterval(delay);
                            }
                        }, 1000);
                    }
                }
            };

            function openApp(src) {
                // 通过iframe的方式试图打开APP，如果能正常打开，会直接切换到APP，并自动阻止a标签的默认行为
                // 否则打开a标签的href链接
                var ifr = document.createElement('iframe');
                ifr.src = src;
                ifr.style.display = 'none';
                document.body.appendChild(ifr);
                window.setTimeout(function() {
                    document.body.removeChild(ifr);
                }, 2000);
            }

            function numberGrow(ele) {
                var number = ele;
                var n = 0;
                var t = setInterval(function() {
                    if (n < 16000) {
                        n = n + 500;
                    } else if (n >= 16000 && n < 17950) {
                        n = n + 18;
                    } else if (n >= 17950 && n < 18000) {
                        n++;
                    } else if (n == 18000) {
                        clearInterval(t)
                    }
                    number.html(n)
                }, 25)
            }


            //生成真实电话号码
            setInterval(function() {
                randomNews();
            }, 1000)

            function addNews() {
                var parent = document.querySelector('.loanNews');
                for (var i = 0; i < 6; i++) {
                    var p = document.createElement('P');
                    p.innerHTML = randomNews();
                    parent.appendChild(p)
                }
            }

            function randomNews() {
                var reg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
                var tel;
                while (!reg.test(tel)) {
                    tel = produceTel()
                }
                var moneyNumber = Math.floor(Math.random() * (10 - 1)) + 1;
                var mStr = moneyNumber + ',000'
                var str = '恭喜' + tel.substr(0, 3) + '****' + tel.substr(7, 11) + '用户借款' + mStr + '元';
                return str;
            }

            function produceTel() {
                var nums = [];
                for (i = 0; i < 11; i++) {
                    var n = Math.floor(Math.random() * 10);
                    nums.push(n);
                }
                var tel = nums.join("")
                return tel;
            }

        })
    </script>
</body>



</html>