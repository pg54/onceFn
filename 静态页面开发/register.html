<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <script src="./js/rem.js"></script>
    <link rel="stylesheet" href="./css/normalize.css">
    <title>包有钱 注册</title>
    <style>
        body {
            background: #fffcf7;
        }
        
        .imgWrap {
            margin-bottom: 0.7733rem;
        }
        
        .content {
            width: 7.9467rem;
            /* height: 6.5867rem; */
            overflow: hidden;
            padding-top: 0.16rem;
            margin: 0 auto 1.4667rem;
            border-radius: 0.4rem;
            background: #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .contentLine {
            width: 7.0667rem;
            margin: 0 auto;
            padding: 0.5333rem 0.16rem 0.2133rem 0.16rem;
            border-bottom: 0.0133rem solid #f1f1f1;
        }
        
        .content input {
            font-size: 0.3467rem;
            border: 0;
            outline: none;
        }
        
        .inputTitle {
            font-size: 0.4rem;
            color: #333333;
            margin-right: 0.5333rem;
        }
        
        .codeTitle {
            margin-right: 1.3333rem;
        }
        
        .code {
            width: 2.9867rem;
        }
        
        .content .getCode {
            display: inline-block;
            width: 1.68rem;
            height: 0.6667rem;
            line-height: 0.6667rem;
            text-align: center;
            font-size: 0.32rem;
            color: #ff9500;
            border: 0.0133rem solid #ffaa33;
            border-radius: 0.08rem;
            margin-left: 0.1333rem;
            background: #ffffff;
        }
        
        .content .ready {
            background: #ff9500;
            color: #ffffff;
        }
        
        .content .getMoney {
            display: block;
            width: 4.4267rem;
            height: 0.9067rem;
            line-height: 0.9067rem;
            margin: 0.6rem auto 0.6rem;
            border-radius: 0.4267rem;
            background: #ff9500;
            color: #ffffff;
            font-size: 0.4267rem;
            text-align: center;
        }
        
        .footer {
            margin-bottom: 0.5333rem;
            font-size: 0.2667rem;
            color: #999999;
            text-align: center;
        }
        
        .notifyWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #4a4a4a;
            display: none;
            transition: all ease-in-out 0.4s;
        }
        
        .notify {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 7.8rem;
            height: 2.4rem;
            border-radius: 0.08rem;
            text-align: center;
            font-size: 0.4rem;
            background: #ffffff;
            display: block;
            transition: all 0.8s ease-in-out;
        }
        
        .notify_content {
            height: 1.2rem;
            line-height: 1.2rem;
            text-align: center;
            border-bottom: 1px solid #f2f2f2;
        }
        
        .notify_action {
            height: 1.2rem;
            line-height: 1.2rem;
            text-align: center;
            color: #ff9500;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="imgWrap">
            <img width="100%" src="./images/banner@2x.png" srcset="./images/banner@2x.png 2x,./images/banner@3x.png 3x" />
        </div>
        <div class="content">
            <div class="contentLine">
                <span class="inputTitle">手机号码</span><input class="tel" type="tel" maxlength="16" placeholder="请输入手机号">
            </div>
            <div class="contentLine">
                <span class="inputTitle">动态密码</span><input class="code" type="text" maxlength="6" placeholder="短信验证码"><input class="getCode" value="获取验证" disabled='disabled'>
            </div>
            <div class="contentLine">
                <span class="inputTitle codeTitle">密码</span><input class="password" type="password" maxlength="6" placeholder="请设置6位数密码">
            </div>
            <input class="getMoney" value="马上拿钱">
        </div>
        <div class="footer">
            <p class="backup">粤ICP备17123265号-1</p>
            <p class="companyInfo">珠海横琴同程金融服务外包有限公司</p>
        </div>
        <input type="hidden" id="userId" value="${userId}">
        <input type="hidden" id="channel" value="${channel}">
    </div>
    <div class="notifyWrap">
        <div class="notify">
            <div class="notify_content">
                请输入正确的手机号
            </div>
            <div class="notify_action">
                确定
            </div>
        </div>
    </div>

    <script src="./js/jquery-2.1.1.js"></script>
    <script>
        // 手机号验证： /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/
        $(".tel").bind('input', function() {
            if ($(this).val() != "") {
                $('.getCode').removeAttr("disabled").addClass('ready');
            } else {
                $('.getCode').attr("disabled", "disabled").removeClass('ready');
            }
        });

        $('.getCode').on('click', function() {
            console.log('send code');
            var v = $('.tel').val();
            var reg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
            console.log(reg.test(v));
            if (v == '') return
            if (reg.test(v)) {
                $('.getCode').attr("disabled", "disabled");
                var time = 60;
                $(this).val(time + 's');
                timeGap(60)
            } else {
                // $('.warr').hide();
                $('.notifyWrap').show();
                // setTimeout(() => {
                //     $('.notifyWrap').hide();
                // }, 1500);
            }
        })

        $('.getMoney').on('click', function() {
            var reg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
            var code = $(".code").val();
            var psd = $(".password").val();
            if (!reg.test($(".tel").val())) {
                return $('.notifyWrap').show();
            }
            if (code && code.length !== 4) {
                $('.notify_content').html('请输入正确的验证码');
                return $('.notifyWrap').show();
            }
            if (psd && psd.length !== 6) {
                $('.notify_content').html('请设置正确的6位密码');
                return $('.notifyWrap').show();
            }
            $.ajax({
                type: "POST",
                dataType: "text",
                url: 'http://127.0.0.1:9999/api/changeInfo',
                data: '',
                data: {
                    userId: $("#userId").val(),
                    phoneNumber: $(".tel").val(),
                    captcha: $(".code").val(),
                    password: $(".password").val(),
                    channel: $("#channel").val(),
                    /*toda 注册类型*/
                },
                success: function(res) {
                    console.log(res);
                    if (res.message == "success") {
                        $(".getMoney").attr({
                            "disabled": "disabled"
                        });
                        // location.href = "${ctx}/html5/cms/regOk/" + $("#channel").val();
                    } else {
                        alert(res);

                    }
                }
            });
        })

        $('.notify_action').on('click', function() {
            $('.notify_content').html('请输入正确的验证码')
            $('.notifyWrap').hide();
        })

        function timeGap(time) {
            setInterval(function() {
                console.log(this)
                time--;
                if (time > 0) {
                    $('.getCode').val(time + 's');
                } else {
                    $('.getCode').val('获取验证');
                    $('.getCode').removeAttr("disabled");
                }
            }, 1000)
        }
    </script>

</body>

</html>